models:
  image: tp33/django
  container_name: models
  external_links:
    - mysql:db
  ports:
    - "8001:8000"
  volumes:
    - ./src/bazaar:/app/bazaar
  command: bash -c "chmod +x /app/bazaar/setup.sh && /app/bazaar/setup.sh" 
exp:
  image: tp33/django
  container_name: exp
  links:
    - models:models-api
  ports:
    - "8002:8000"
  volumes:
    - ./src/experience:/app/experience
  command: bash -c "chmod +x /app/experience/setup.sh && /app/experience/setup.sh"

web:
  build: ./src/frontend/app
  container_name: web
  links:
    - exp:exp-api
  ports:
    - "8003:80"
  volumes:
    - ./src/frontend/app:/app/

kafka:
  image: spotify/kafka
  container_name: kafka
  environment:
    ADVERTISED_HOST: kafka
    ADVERTISED_PORT: 9092
  hostname: kafka

es:
  image: elasticsearch:6.7.0
  container_name: es
  ports:
    - "9200:9200"

batch:
  image: tp33/django
  container_name: batch
  links:
    - kafka:kafka
    - es:es
  volumes:
    - ./src/batch/app:/app/
  command: bash -c "python3 ProducerConsumer.py"